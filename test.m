Image=imread('pic/lena24.bmp');
% ???????????????
[M,N,nDims]=size(Image);
Image=im2double(Image);
HISTEQ=Image;
for i=1:nDims  % ??????????????
    H=Image(:,:,i);
    [counts,x]=imhist(H);  % ??????x?????count
    loction=find(counts~=0); % ??????????0????
    MinCDF=min(counts(loction)); 
    for j=1:length(loction)
        CDF=sum(counts(loction(1:j)));  % ??????????????CDF
        P=find(H==x(loction(j)));
        H(P)=(CDF-MinCDF)/(M*N-MinCDF); % ??????
    end
    HISTEQ(:,:,i)=H; % ????????????????
end

figure,  % ?????????????????
if nDims==3||nDims==1  % ??????RGB???????????????
    subplot(1,2,1),imshow(Image);title('Original picture');
    subplot(1,2,2),imshow(HISTEQ);title('Equalization picture');
else  % ????????????TM 3,2,1?????????
    subplot(1,2,1),imshow(Image(:,:,[3,2,1]));title('Original picture');
    subplot(1,2,2),imshow(HISTEQ(:,:,[3,2,1]));title('Equalization picture');
end
% ??????????????????Result_HISTEQ??